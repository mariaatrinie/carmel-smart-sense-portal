<!DOCTYPE html>
<html>
<head>
    <title>SmartSense Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="layout">

    <!-- SIDEBAR -->
    <div class="sidebar">
        <h2>Carmel Smart-Sense</h2>
        <p class="tag">Sense • Predict • Protect</p>

        <ul>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="analytics.html">Analytics</a></li>
            <li><a href="automation.html">Automation</a></li>
            <li><a href="alerts.html">Alerts</a></li>
            <li><a href="mapview.html">Map View</a></li>
            <li><a href="settings.html">Settings</a></li>
            <li class="active"><a href="dashboard.html">Dashboard</a></li>
            <li onclick="logout()">Logout</li>
        </ul>
    </div>

    <!-- MAIN -->
    <div class="main">

        <h1>SmartSense Dashboard</h1>
        <p class="subtitle">All Systems Online • ESP32 Connected</p>

        <!-- SENSOR GRID -->
        <div class="cards">

            <div class="sensor-card">
                <h3>Temperature</h3>
                <div class="value" id="temp">--°C</div>
                <span class="status">Humidity <b id="hum">--%</b></span>
            </div>

            <div class="sensor-card green">
                <h3>Air Quality</h3>
                <div class="value" id="air">--</div>
                <span class="status good" id="airStatus">Waiting...</span>
            </div>

            <div class="sensor-card blue">
                <h3>Soil Moisture</h3>
                <div class="value" id="soil">--%</div>
                <span class="status">Level</span>
            </div>

            <div class="sensor-card yellow">
                <h3>Sound Level</h3>
                <div class="value" id="sound">-- dB</div>
                <span class="status">Status</span>
            </div>

            <div class="sensor-card red">
                <h3>Gas Leak</h3>
                <div class="value" id="gas">-- ppm</div>
                <span class="badge safe" id="gasStatus">Safe</span>
            </div>

            <div class="sensor-card red">
                <h3>CO Level</h3>
                <div class="value" id="co">-- ppm</div>
                <span class="badge safe" id="coStatus">Safe</span>
            </div>

            <div class="sensor-card yellow">
                <h3>Alcohol</h3>
                <div class="value" id="alcohol">-- ppm</div>
                <span class="badge safe">Safe</span>
            </div>

            <div class="sensor-card blue">
                <h3>Rain Sensor</h3>
                <div class="value" id="rain">--</div>
                <span class="status">Weather</span>
            </div>

        </div>

        <!-- CONTROL SECTION -->
        <div class="control-section">

            <!-- Exhaust Fan -->
            <div class="control-card fan-card">
                <h3>Exhaust Fan</h3>

                <img src="fan_buzz.png" class="control-img" width="50"height="50">

                <p>12V DC Motor</p>

                <label class="switch">
                    <input type="checkbox" id="fanToggle">
                    <span class="slider"></span>
                </label>
            </div>

            <!-- Buzzer -->
            <div class="control-card buzzer-card">
                <h3>Buzzer</h3>

                <img src="buzz.png" class="control-img" width="60"height="50">

                <p>Alert System</p>

                <label class="switch">
                    <input type="checkbox" id="buzzerToggle">
                    <span class="slider"></span>
                </label>
            </div>

        </div>

    </div>
</div>

<script>
fetch("http://localhost:5000/api/sensor/latest")
.then(res=>res.json())
.then(data=>{

  temp.innerText = data.temperature+"°C";
  hum.innerText = data.humidity+"%";
  air.innerText = data.airQuality;
  soil.innerText = data.soil+"%";
  sound.innerText = data.sound+" dB";
  gas.innerText = data.gas+" ppm";
  co.innerText = data.co+" ppm";
  alcohol.innerText = data.alcohol+" ppm";
  rain.innerText = data.rain ? "Rain Detected" : "No Rain";

  airStatus.innerText = data.airQuality<100?"Excellent":"Poor";
  gasStatus.innerText = data.gas<50?"Safe":"Leak!";
  coStatus.innerText = data.co<10?"Safe":"Danger!";
});

// FAN TOGGLE
document.getElementById("fanToggle").addEventListener("change", function() {
    console.log(this.checked ? "Fan ON" : "Fan OFF");
});

// BUZZER TOGGLE
document.getElementById("buzzerToggle").addEventListener("change", function() {
    console.log(this.checked ? "Buzzer ON" : "Buzzer OFF");
});

function logout(){
    localStorage.removeItem("isLoggedIn");
    window.location.href="login.html";
}
</script>

</body>
</html>